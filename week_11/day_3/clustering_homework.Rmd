---
title: "Clustering Homework"
output: html_notebook
---

```{r}
library(tidyverse)
library(cluster)
library(factoextra)
library(dendextend)
library(corrplot)
library(janitor)
```
```{r}
customer_data <- read_csv("data/mall_customers.csv") %>% clean_names()

View(customer_data)


customer_data %>% 
ggplot(aes(x = annual_income_k, y = spending_score_1_100)) +
geom_point()

customer_data %>% 
ggplot(aes(x = annual_income_k, y = spending_score_1_100, colour = gender)) +
geom_point()

customer_data %>% 
ggplot(aes(x = annual_income_k, y = spending_score_1_100, colour = age)) +
geom_point()

corrplot(cor(customer_data), method = "number", type = "lower")

```
It looks like there are five different groups: 

1: low income and low spending 
2: low income and high spending 
3: high income and low spending 
4: high income and high spending 
5: medium income, medium spending. 

```{r}

customer_clean <- customer_data %>% 
  select(annual_income_k, spending_score_1_100)

```

```{r}
customer_scaled <- customer_clean %>% 
   mutate_if(is.numeric, scale)
  
```

```{r}

clustered_customers <- kmeans(customer_scaled, 
                            centers = 5, 
                            nstart = 25)
clustered_customers

library(broom)

# Set min & max number of clusters want to look at 
max_k <- 20 

k_clusters <- tibble(k = 1:max_k) %>%
  mutate(
    kclust = map(k, ~ kmeans(customer_scaled, .x, nstart = 25)), 
    tidied = map(kclust, tidy),
    glanced = map(kclust, glance),
    augmented = map(kclust, augment, customer_scaled)
  )

k_clusters
```
```{r}
clusterings <- k_clusters %>%
  unnest(glanced)

clusterings

ggplot(clusterings, aes(x=k, y=tot.withinss)) +
  geom_point() +
    geom_line() +
    scale_x_continuous(breaks = seq(1, 20, by = 1))

```
```{r}
fviz_nbclust(customer_scaled, 
             kmeans, 
             method = "wss", 
             nstart = 25)
```
```{r}
fviz_nbclust(customer_scaled, 
             kmeans, 
             method = "silhouette", 
             nstart = 25)
```
```{r}
fviz_nbclust(customer_scaled, 
             kmeans, 
             method = "gap_stat", 
             nstart = 25, 
             k.max = 10)
```
I am, at least from two out of the four plots, justified in sticking with the five groups I expected. 


```{r}
 clusterings %>% 
  unnest(cols = c(augmented)) %>%
  filter(k == 5) %>%
  ggplot(aes(x = annual_income_k, y = spending_score_1_100)) +
  geom_point(aes(color = .cluster))
```

The clustering matches the categories I found in the exploratory analysis: 

1: low income and low spending 
2: low income and high spending 
3: high income and low spending 
4: high income and high spending 
5: medium income, medium spending. 

It makes sense and seems like a good fit. 



